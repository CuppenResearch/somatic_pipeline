# Template for generating RDF triples from SNV1 output (in-house annotation
# pipeline). For more information see bamannotate.md file in doc_central.
#
# Create RDF with for example 
#
#   env INFILE=variants.snv1 erb annotate_snv1.rdf
#
# or full
#
#   env INFILE=test/data/input/snv/example-varscan.snp.snv1 erb ./templates/rdf/annotate_snv1.rdf
#
# Example output: 
#
#  :annotated_snv_1_10338145_G  :chr     "1" .
#  :annotated_snv_1_10338145_G  :pos     10338145 .
#  :annotated_snv_1_10338145_G  :snv     true .
#  :annotated_snv_1_10338145_G  :ref     "A" .
#  :annotated_snv_1_10338145_G  :var     "G" .
#  :annotated_snv_1_10338145_G  :strand  1 .
#  :annotated_snv_1_10338145_G  :gene_name  "KIF1B" .
#  :annotated_snv_1_10338145_G  :snp_id  "novel" .
#  :annotated_snv_1_10338145_G  :effect  :missense_variant .
#  :annotated_snv_1_10338145_G  :gene_id        :ENSG00000054523 .
#  :annotated_snv_1_10338145_G  :tid  :ENST00000377081 .
#  :annotated_snv_1_10338145_G  :protein_id     :ENSP00000366284 .
#  :annotated_snv_1_10338145_G  :polyphen  0.007 .
#   :annotated_snv_1_10338145_G  :sift      1 .

<%= File.read(File.dirname(__FILE__)+'/preamble.rdf')  %>

<%
   id = prev_id = nil
   File.open(ENV["INFILE"]).each_line do |line|
     next if line =~ /^#/
     fields = line.split(/\t/)
     chr = fields[0]
     pos = fields[1]
     (ref,var) = fields[2].split(/\//)
     (aaref,aavar) = fields[11].split(/\//)
     high_pop_freq = fields[23] if fields[23] != 'NA'
     #  id = BioRdf::Turtle.mangle_identifier(gene)
     prev_id = id
     id = ':'+['annotated_snv',chr,pos,var].join('_')
     tid = id+'_'+fields[26]
%>
    <% if id != prev_id %>
    <%= id %>  :chr     "<%= chr %>" .
    <%= id %>  :pos     <%= pos %> .
    <%= id %>  :snv     true .
    <%= id %>  :ref     "<%= ref %>" .
    <%= id %>  :var     "<%= var %>" .
    <%= id %>  :aa_ref  "<%= aaref %>" .
    <%= id %>  :aa_var  "<%= aavar %>" .
    <%= id %>  :strand  <%= fields[3] %> .
    <%= id %>  :gene_name  "<%= fields[9] %>" .
    <%= id %>  :snp_id  "<%= fields[12] %>" .
    <%= id %>  :effect  :<%= fields[13] %> .
    <%= id %>  :gene_id        :<%= fields[25] %> .
    <% if high_pop_freq %><%= id %>  :high_pop_freq  <%= high_pop_freq %> .
    <%= id %>  :high_pop  "<%= fields[24] %>" .
    <% end %>
    <% end %>
    <%= tid %>  :snv_id  <%= id %> .
    <%= tid %>  :tid  :<%= fields[26] %> .
  <% if fields[27] != 'NA' and aaref != 'NA' and fields[16] != 'NA' %>
    <%= tid %>  :protein_id     :<%= fields[27] %> .
    <%= tid %>  :polyphen  <%= fields[16] %> .
    <% if fields[18] != 'NA' %><%= tid %>  :sift      <%= fields[18] %> .
    <% end %>
  <% end %>
<% end %>
